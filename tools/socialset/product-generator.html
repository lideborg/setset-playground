<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Generator</title>
    <link rel="stylesheet" href="/shared/css/tokens.css">
    <link rel="stylesheet" href="/shared/css/base.css">
    <link rel="stylesheet" href="/shared/css/components.css">
    <style>
        .container {
            max-width: 900px;
        }

        .generator-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-md);
            margin-bottom: var(--space-lg);
        }

        .generator-section {
            background: var(--off-white);
            padding: var(--space-md);
            border-radius: var(--radius-md);
        }

        .generator-section.full-width {
            grid-column: 1 / -1;
        }

        .section-title {
            font-size: var(--text-xs);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--slate);
            margin-bottom: var(--space-sm);
        }

        .gender-toggle {
            display: flex;
            gap: var(--space-xs);
        }

        .gender-toggle .btn {
            flex: 1;
        }

        select.input {
            width: 100%;
            padding: 10px 12px;
            font-size: var(--text-sm);
            border: 1px solid var(--gainsboro);
            border-radius: var(--radius-sm);
            background: var(--white);
            cursor: pointer;
        }

        select.input:focus {
            outline: none;
            border-color: var(--jet);
        }

        .style-presets {
            display: flex;
            gap: var(--space-xs);
            margin-bottom: var(--space-sm);
            flex-wrap: wrap;
        }

        .style-input {
            width: 100%;
            padding: 10px 12px;
            font-size: var(--text-sm);
            border: 1px solid var(--gainsboro);
            border-radius: var(--radius-sm);
            resize: none;
            min-height: 60px;
        }

        .style-input:focus {
            outline: none;
            border-color: var(--jet);
        }

        .style-input::placeholder {
            color: var(--ash-grey);
        }

        .model-toggle {
            display: flex;
            gap: var(--space-xs);
        }

        .model-toggle .btn {
            flex: 1;
        }

        .count-row {
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }

        .count-slider {
            flex: 1;
        }

        .count-value {
            font-size: var(--text-lg);
            font-weight: 600;
            min-width: 30px;
            text-align: center;
        }

        .generate-section {
            margin-top: var(--space-md);
        }

        .calc-display {
            font-size: var(--text-sm);
            color: var(--slate);
            margin-bottom: var(--space-sm);
            text-align: center;
        }

        /* Progress */
        .progress-section {
            display: none;
            margin-top: var(--space-lg);
            padding: var(--space-lg);
            background: var(--white);
            border-radius: var(--radius-lg);
            border: 1px solid var(--gainsboro);
        }

        .progress-section.visible {
            display: block;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-sm);
        }

        .progress-title {
            font-size: var(--text-xs);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--slate);
        }

        .progress-count {
            font-size: var(--text-sm);
            font-weight: 600;
            color: var(--jet);
        }

        .progress-bar-container {
            height: 8px;
            background: var(--off-white);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: var(--jet);
            border-radius: 4px;
            transition: width 0.3s ease;
            width: 0%;
        }

        /* Results */
        .results-section {
            display: none;
            margin-top: var(--space-lg);
        }

        .results-section.visible {
            display: block;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-md);
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: var(--space-md);
        }

        .result-card {
            position: relative;
            border-radius: var(--radius-md);
            overflow: hidden;
            cursor: pointer;
            border: 2px solid var(--gainsboro);
            transition: all var(--transition-fast);
        }

        .result-card:hover {
            border-color: var(--jet);
        }

        .result-card img {
            width: 100%;
            aspect-ratio: 3/4;
            object-fit: cover;
            display: block;
        }

        .result-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: var(--space-sm);
            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
            opacity: 0;
            transition: opacity var(--transition-fast);
        }

        .result-card:hover .result-overlay {
            opacity: 1;
        }

        .result-actions {
            display: flex;
            gap: var(--space-xs);
        }

        .result-btn {
            flex: 1;
            padding: 6px 10px;
            background: var(--white);
            border: none;
            border-radius: var(--radius-sm);
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .result-btn:hover {
            background: var(--jet);
            color: var(--white);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="hero">
            <h1>Product Generator</h1>
            <p class="hero-subtitle">Generate flat-lay and product photography for your wardrobe library</p>
        </div>

        <!-- Generator Controls -->
        <div class="generator-grid">
            <!-- Gender -->
            <div class="generator-section">
                <div class="section-title">Gender</div>
                <div class="gender-toggle">
                    <button class="btn btn--toggle active" data-gender="female">Female</button>
                    <button class="btn btn--toggle" data-gender="male">Male</button>
                </div>
            </div>

            <!-- Category -->
            <div class="generator-section">
                <div class="section-title">Category</div>
                <select class="input" id="category-select">
                    <option value="top">Top (T-shirts, Blouses)</option>
                    <option value="sweater">Sweater (Knits, Cardigans)</option>
                    <option value="outerwear">Outerwear (Jackets, Coats)</option>
                    <option value="dress">Dress</option>
                    <option value="bottom">Bottom (Pants, Skirts)</option>
                    <option value="shoes">Shoes</option>
                    <option value="bag">Bag</option>
                    <option value="accessories">Accessories (Eyewear, Jewelry)</option>
                </select>
            </div>

            <!-- Shot Type -->
            <div class="generator-section">
                <div class="section-title">Shot Type</div>
                <select class="input" id="shot-select">
                    <option value="flatlay">Flat Lay (Top-down)</option>
                    <option value="ghost">Ghost Mannequin</option>
                    <option value="hanger">On Hanger</option>
                    <option value="styled">Styled Arrangement</option>
                </select>
            </div>

            <!-- Model -->
            <div class="generator-section">
                <div class="section-title">AI Model</div>
                <div class="model-toggle">
                    <button class="btn btn--toggle active" data-model="reve">Reve</button>
                    <button class="btn btn--toggle" data-model="zimage">Z Image</button>
                </div>
            </div>

            <!-- Style -->
            <div class="generator-section full-width">
                <div class="section-title">Style Influence</div>
                <div class="style-presets">
                    <button class="btn btn--toggle btn--sm" data-style="minimal">Minimal</button>
                    <button class="btn btn--toggle btn--sm" data-style="luxury">Luxury</button>
                    <button class="btn btn--toggle btn--sm" data-style="avantgarde">Avant-garde</button>
                    <button class="btn btn--toggle btn--sm" data-style="streetwear">Streetwear</button>
                    <button class="btn btn--toggle btn--sm" data-style="classic">Classic</button>
                </div>
                <textarea class="style-input" id="style-input" placeholder="Add style notes... e.g. 'high-end designer feel, architectural silhouette, muted earth tones'"></textarea>
            </div>

            <!-- Count -->
            <div class="generator-section full-width">
                <div class="section-title">Number of Images</div>
                <div class="count-row">
                    <input type="range" class="slider count-slider" id="count-slider" min="1" max="8" value="4">
                    <span class="count-value" id="count-value">4</span>
                </div>
            </div>
        </div>

        <!-- Generate -->
        <div class="generate-section">
            <div class="calc-display" id="calc-display">4 images @ $0.02 each = $0.08</div>
            <button class="btn btn--primary btn--lg btn--block" id="generate-btn">Generate Products</button>
        </div>

        <!-- Progress -->
        <div class="progress-section" id="progress-section">
            <div class="progress-header">
                <span class="progress-title">Generating</span>
                <span class="progress-count" id="progress-count">0 / 0</span>
            </div>
            <div class="progress-bar-container">
                <div class="progress-bar" id="progress-bar"></div>
            </div>
        </div>

        <!-- Results -->
        <div class="results-section" id="results-section">
            <div class="results-header">
                <h2>Generated Products</h2>
                <button class="btn" onclick="downloadAll()">Download All</button>
            </div>
            <div class="results-grid" id="results-grid"></div>
        </div>
    </div>

    <!-- Lightbox -->
    <div class="lightbox" id="lightbox">
        <div class="lightbox-content">
            <button class="lightbox-close" onclick="closeLightbox()">&times;</button>
            <div class="lightbox-left">
                <img src="" alt="" class="lightbox-image" id="lightbox-image">
            </div>
            <div class="lightbox-right">
                <div class="lightbox-section">
                    <h3 class="lightbox-section-title">Category</h3>
                    <p id="lightbox-category"></p>
                </div>
                <div class="lightbox-section">
                    <h3 class="lightbox-section-title">Prompt</h3>
                    <p class="lightbox-prompt-text" id="lightbox-prompt"></p>
                </div>
                <button class="lightbox-download" id="lightbox-download">Download Image</button>
            </div>
        </div>
    </div>

    <!-- Loading -->
    <div class="loading-overlay" id="loading">
        <div class="spinner"></div>
        <p class="loading-text" id="loading-text">Generating...</p>
    </div>

    <!-- Scripts -->
    <script src="/shared/js/models.js"></script>
    <script src="/shared/js/utils.js"></script>
    <script src="/shared/js/api.js"></script>
    <script>
        // State
        const state = {
            gender: 'female',
            category: 'top',
            shotType: 'flatlay',
            model: 'reve',
            stylePresets: [],
            styleText: '',
            count: 4,
            results: [],
            lightboxIndex: 0
        };

        // Style preset descriptions (no brand names, just essence)
        const STYLE_PRESETS = {
            minimal: 'clean minimalist aesthetic, refined simplicity, quiet luxury, understated elegance',
            luxury: 'high-end designer quality, impeccable craftsmanship, premium materials, sophisticated silhouette',
            avantgarde: 'architectural sculptural form, unconventional design, artistic expression, deconstructed elements',
            streetwear: 'contemporary urban aesthetic, relaxed fit, modern casual, effortless cool',
            classic: 'timeless elegant design, refined traditional style, enduring sophistication'
        };

        // Category-specific prompt templates
        const CATEGORY_PROMPTS = {
            top: {
                flatlay: 'Professional flat lay product photography of a {GENDER} {ITEM}, perfectly arranged on clean white surface, shot from directly above 90-degree angle, smooth fabric neatly positioned, soft diffused lighting, minimal shadows, {STYLE}. Commercial e-commerce quality, 3:4 aspect ratio.',
                ghost: 'Ghost mannequin product photography of a {GENDER} {ITEM}, invisible mannequin technique showing garment shape, clean white background, professional studio lighting, front view, {STYLE}. Commercial catalog quality.',
                hanger: 'Product photography of a {GENDER} {ITEM} on minimal white wooden hanger, clean white background, natural drape showing fabric weight, soft even lighting, {STYLE}. Premium e-commerce quality.',
                styled: 'Editorial flat lay of a {GENDER} {ITEM} artfully arranged with minimal props, clean aesthetic composition, overhead shot, soft natural lighting, {STYLE}. Magazine editorial quality.'
            },
            sweater: {
                flatlay: 'Professional flat lay of a {GENDER} knit {ITEM}, neatly folded or arranged on white surface, texture visible, shot from above, soft lighting highlighting knit pattern, {STYLE}. High-end product photography.',
                ghost: 'Ghost mannequin photography of a {GENDER} {ITEM}, showing silhouette and drape, clean white background, professional lighting, {STYLE}. Commercial quality.',
                hanger: 'Product shot of a {GENDER} knit {ITEM} on wooden hanger, white background, natural drape, cozy texture visible, {STYLE}. Premium catalog photography.',
                styled: 'Editorial arrangement of a {GENDER} {ITEM} with minimal styling, overhead view, textural focus, {STYLE}. Lifestyle product photography.'
            },
            outerwear: {
                flatlay: 'Flat lay product photography of a {GENDER} {ITEM}, arranged to show structure and details, clean white background, shot from above, soft studio lighting, {STYLE}. Premium e-commerce quality.',
                ghost: 'Ghost mannequin shot of a {GENDER} {ITEM}, showing tailored shape, clean white background, professional lighting highlighting construction, {STYLE}. High-end catalog photography.',
                hanger: 'Product photography of a {GENDER} {ITEM} on premium hanger, white background, showing full length and silhouette, {STYLE}. Designer quality presentation.',
                styled: 'Editorial flat lay of a {GENDER} {ITEM} with minimal props, artistic arrangement, overhead shot, {STYLE}. Magazine quality.'
            },
            dress: {
                flatlay: 'Professional flat lay of a {GENDER} {ITEM}, elegantly arranged on white surface, fabric smoothly positioned, shot from directly above, soft diffused lighting, {STYLE}. High-end product photography.',
                ghost: 'Ghost mannequin photography of a {GENDER} {ITEM}, showing silhouette and drape, clean white background, professional lighting, {STYLE}. Premium catalog quality.',
                hanger: 'Product shot of a {GENDER} {ITEM} on minimal hanger, white background, showing full length and movement, soft lighting, {STYLE}. Designer presentation quality.',
                styled: 'Editorial flat lay of a {GENDER} {ITEM} artfully arranged, overhead composition, {STYLE}. Magazine editorial quality.'
            },
            bottom: {
                flatlay: 'Professional flat lay of {GENDER} {ITEM}, neatly arranged on white surface, showing shape and details, shot from above, soft studio lighting, {STYLE}. Commercial product photography.',
                ghost: 'Ghost mannequin shot of {GENDER} {ITEM}, showing fit and silhouette, clean white background, professional lighting, {STYLE}. E-commerce quality.',
                hanger: 'Product photography of {GENDER} {ITEM} on clip hanger, white background, showing full length, {STYLE}. Catalog quality.',
                styled: 'Editorial flat lay of {GENDER} {ITEM} with minimal styling, overhead view, {STYLE}. Lifestyle product shot.'
            },
            shoes: {
                flatlay: 'Professional product photography of {GENDER} {ITEM}, clean white background, 45-degree angle showing profile and details, soft studio lighting, {STYLE}. Premium e-commerce quality.',
                ghost: 'Product shot of {GENDER} {ITEM} pair, one shoe front-facing one at angle, white background, professional lighting highlighting materials, {STYLE}. High-end catalog photography.',
                hanger: 'Product photography of {GENDER} {ITEM}, three-quarter view, clean white background, soft shadows, {STYLE}. Designer presentation.',
                styled: 'Editorial product shot of {GENDER} {ITEM} with minimal styling, artistic angle, {STYLE}. Magazine quality.'
            },
            bag: {
                flatlay: 'Professional product photography of a {GENDER} {ITEM}, clean white background, front view showing hardware and details, soft studio lighting, {STYLE}. Luxury e-commerce quality.',
                ghost: 'Product shot of a {GENDER} {ITEM}, structured presentation, white background, professional lighting highlighting craftsmanship, {STYLE}. High-end catalog.',
                hanger: 'Product photography of a {GENDER} {ITEM}, slightly angled view, white background, showing dimension and shape, {STYLE}. Premium presentation.',
                styled: 'Editorial product shot of a {GENDER} {ITEM} with minimal props, artistic composition, {STYLE}. Magazine quality.'
            },
            accessories: {
                flatlay: 'Professional flat lay of {GENDER} {ITEM}, arranged on white surface, shot from above or slight angle, soft lighting, {STYLE}. Premium product photography.',
                ghost: 'Product photography of {GENDER} {ITEM}, clean white background, professional lighting highlighting details and materials, {STYLE}. Luxury catalog quality.',
                hanger: 'Product shot of {GENDER} {ITEM}, elegant presentation, white background, soft shadows, {STYLE}. Designer quality.',
                styled: 'Editorial arrangement of {GENDER} {ITEM}, artistic composition, minimal styling, {STYLE}. Magazine editorial quality.'
            }
        };

        // Item variations per category
        const ITEM_VARIATIONS = {
            top: ['cotton t-shirt', 'silk blouse', 'linen shirt', 'jersey top', 'tailored button-up', 'draped top', 'ribbed tank', 'oversized tee'],
            sweater: ['cashmere sweater', 'wool cardigan', 'chunky knit pullover', 'fine gauge knit', 'ribbed sweater', 'cable knit jumper', 'lightweight knit', 'turtleneck sweater'],
            outerwear: ['tailored blazer', 'wool coat', 'leather jacket', 'trench coat', 'quilted jacket', 'bomber jacket', 'oversized coat', 'structured jacket'],
            dress: ['midi dress', 'slip dress', 'shirt dress', 'wrap dress', 'maxi dress', 'mini dress', 'knit dress', 'structured dress'],
            bottom: ['tailored trousers', 'wide-leg pants', 'slim jeans', 'pleated skirt', 'midi skirt', 'shorts', 'culottes', 'straight-leg pants'],
            shoes: ['leather loafers', 'minimalist sneakers', 'heeled boots', 'ballet flats', 'ankle boots', 'sandals', 'oxford shoes', 'mules'],
            bag: ['leather tote', 'structured handbag', 'crossbody bag', 'clutch', 'shoulder bag', 'bucket bag', 'mini bag', 'messenger bag'],
            accessories: ['sunglasses', 'silk scarf', 'leather belt', 'minimal jewelry', 'watch', 'earrings', 'necklace', 'bracelet']
        };

        // Elements
        const elements = {
            categorySelect: document.getElementById('category-select'),
            shotSelect: document.getElementById('shot-select'),
            styleInput: document.getElementById('style-input'),
            countSlider: document.getElementById('count-slider'),
            countValue: document.getElementById('count-value'),
            calcDisplay: document.getElementById('calc-display'),
            generateBtn: document.getElementById('generate-btn'),
            progressSection: document.getElementById('progress-section'),
            progressCount: document.getElementById('progress-count'),
            progressBar: document.getElementById('progress-bar'),
            resultsSection: document.getElementById('results-section'),
            resultsGrid: document.getElementById('results-grid'),
            lightbox: document.getElementById('lightbox'),
            lightboxImage: document.getElementById('lightbox-image'),
            lightboxCategory: document.getElementById('lightbox-category'),
            lightboxPrompt: document.getElementById('lightbox-prompt'),
            lightboxDownload: document.getElementById('lightbox-download')
        };

        // Initialize
        function init() {
            // Gender toggle
            document.querySelectorAll('[data-gender]').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('[data-gender]').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    state.gender = btn.dataset.gender;
                });
            });

            // Model toggle
            document.querySelectorAll('[data-model]').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('[data-model]').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    state.model = btn.dataset.model;
                    updateCalc();
                });
            });

            // Style presets (multi-select)
            document.querySelectorAll('[data-style]').forEach(btn => {
                btn.addEventListener('click', () => {
                    btn.classList.toggle('active');
                    const style = btn.dataset.style;
                    if (btn.classList.contains('active')) {
                        state.stylePresets.push(style);
                    } else {
                        state.stylePresets = state.stylePresets.filter(s => s !== style);
                    }
                });
            });

            // Category select
            elements.categorySelect.addEventListener('change', () => {
                state.category = elements.categorySelect.value;
            });

            // Shot type select
            elements.shotSelect.addEventListener('change', () => {
                state.shotType = elements.shotSelect.value;
            });

            // Style text
            elements.styleInput.addEventListener('input', () => {
                state.styleText = elements.styleInput.value;
            });

            // Count slider
            elements.countSlider.addEventListener('input', () => {
                state.count = parseInt(elements.countSlider.value);
                elements.countValue.textContent = state.count;
                updateCalc();
            });

            // Generate button
            elements.generateBtn.addEventListener('click', generate);

            // Lightbox
            document.addEventListener('keydown', (e) => {
                if (!elements.lightbox.classList.contains('visible')) return;
                if (e.key === 'Escape') closeLightbox();
                else if (e.key === 'ArrowLeft') navigateLightbox(-1);
                else if (e.key === 'ArrowRight') navigateLightbox(1);
            });

            updateCalc();
        }

        function updateCalc() {
            const cost = state.model === 'reve' ? 0.02 : 0.015;
            const total = (state.count * cost).toFixed(2);
            elements.calcDisplay.textContent = `${state.count} images @ $${cost.toFixed(3)} each = $${total}`;
        }

        function buildStyleString() {
            const parts = [];

            // Add preset styles
            state.stylePresets.forEach(preset => {
                if (STYLE_PRESETS[preset]) {
                    parts.push(STYLE_PRESETS[preset]);
                }
            });

            // Add custom text
            if (state.styleText.trim()) {
                parts.push(state.styleText.trim());
            }

            return parts.join(', ') || 'clean minimal aesthetic';
        }

        function buildPrompt(itemVariation) {
            const template = CATEGORY_PROMPTS[state.category]?.[state.shotType] || CATEGORY_PROMPTS.top.flatlay;
            const styleString = buildStyleString();

            return template
                .replace('{GENDER}', state.gender === 'female' ? "women's" : "men's")
                .replace('{ITEM}', itemVariation)
                .replace('{STYLE}', styleString);
        }

        async function generate() {
            state.results = [];
            elements.resultsGrid.innerHTML = '';

            // Get random item variations
            const items = ITEM_VARIATIONS[state.category] || ITEM_VARIATIONS.top;
            const selectedItems = [];
            for (let i = 0; i < state.count; i++) {
                selectedItems.push(items[Math.floor(Math.random() * items.length)]);
            }

            // Show progress
            elements.progressSection.classList.add('visible');
            elements.progressCount.textContent = `0 / ${state.count}`;
            elements.progressBar.style.width = '0%';

            let completed = 0;

            // Generate in parallel (batches of 2)
            const batchSize = 2;
            for (let i = 0; i < selectedItems.length; i += batchSize) {
                const batch = selectedItems.slice(i, i + batchSize);

                const promises = batch.map(async (item) => {
                    const prompt = buildPrompt(item);

                    try {
                        const params = {
                            prompt: prompt,
                            num_images: 1,
                            output_format: 'png'
                        };

                        // Model-specific params
                        if (state.model === 'reve') {
                            params.aspect_ratio = '3:4';
                        } else {
                            params.image_size = { width: 768, height: 1024 };
                            params.num_inference_steps = 8;
                            params.enable_safety_checker = false;
                        }

                        const data = await api.generateImage(state.model, params);

                        if (data.images && data.images.length > 0) {
                            state.results.push({
                                url: data.images[0].url,
                                prompt: prompt,
                                category: state.category,
                                item: item
                            });
                            renderResults();
                        }
                    } catch (error) {
                        console.error('Generation error:', error);
                    }

                    completed++;
                    elements.progressCount.textContent = `${completed} / ${state.count}`;
                    elements.progressBar.style.width = `${(completed / state.count) * 100}%`;
                });

                await Promise.all(promises);
            }

            // Hide progress, show results
            elements.progressSection.classList.remove('visible');
            elements.resultsSection.classList.add('visible');
        }

        function renderResults() {
            elements.resultsGrid.innerHTML = state.results.map((result, idx) => `
                <div class="result-card" onclick="openLightbox(${idx})">
                    <img src="${result.url}" alt="${result.item}">
                    <div class="result-overlay">
                        <div class="result-actions">
                            <button class="result-btn" onclick="event.stopPropagation(); downloadImage(${idx})">Download</button>
                        </div>
                    </div>
                </div>
            `).join('');

            elements.resultsSection.classList.add('visible');
        }

        function openLightbox(idx) {
            state.lightboxIndex = idx;
            updateLightboxContent();
            elements.lightbox.classList.add('visible');
        }

        function closeLightbox() {
            elements.lightbox.classList.remove('visible');
        }

        function navigateLightbox(direction) {
            const newIndex = state.lightboxIndex + direction;
            if (newIndex >= 0 && newIndex < state.results.length) {
                state.lightboxIndex = newIndex;
                updateLightboxContent();
            }
        }

        function updateLightboxContent() {
            const result = state.results[state.lightboxIndex];
            elements.lightboxImage.src = result.url;
            elements.lightboxCategory.textContent = `${result.category} - ${result.item}`;
            elements.lightboxPrompt.textContent = result.prompt;
            elements.lightboxDownload.onclick = () => downloadImage(state.lightboxIndex);
        }

        function downloadImage(idx) {
            const result = state.results[idx];
            downloadFile(result.url, `product-${result.category}-${idx + 1}.png`);
        }

        function downloadAll() {
            state.results.forEach((result, idx) => {
                setTimeout(() => {
                    downloadFile(result.url, `product-${result.category}-${idx + 1}.png`);
                }, idx * 500);
            });
        }

        // Initialize
        init();
    </script>
</body>
</html>
